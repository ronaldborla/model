{"version":3,"file":"model.js","sources":["../src/model/collection.ts","../src/model/type.ts","../src/model/key.ts","../src/model/schema.ts","../src/model/utils.ts","../src/model/model.ts","../src/model.ts"],"sourcesContent":["/**\n * Model Collection\n */\nexport class Collection {\n\n\tconstructor() {\n\t\tsuper();\n\t\t\n\t}\n}","/**\n * Key Type\n */\nexport class Type {\n\n\t/**\n\t * The constructor\n\t */\n\tpublic $constructor: any = null;\n\n\t/**\n\t * The name\n\t */\n\tpublic name: string = null;\n\n\t/**\n\t * Safe name\n\t */\n\tpublic safe: string = null;\n\n\t/**\n\t * Type constructor\n\t */\n\tconstructor(name: string, constructor: any) {\n\t\tthis.name = name + '';\n\t\tthis.safe = this.name.toLowerCase();\n\t\tthis.$constructor = constructor;\n\t}\n\n\t/**\n\t * Convert a variable into this type\n\t */\n\tpublic convert(variable) {\n\t\tif (!this.is(variable)) {\n\t\t\tvariable = new this.$constructor(variable);\n\t\t}\n\t\treturn variable;\n\t}\n\n\t/**\n\t * Check if variable is an instance of this type\n\t */\n\tpublic is(variable) {\n\t\treturn ((typeof variable).toLowerCase() === this.safe) || (variable instanceof this.$constructor);\n\t}\n\n\t/**\n\t * Check if constructor matches\n\t */\n\tpublic match(constructor) {\n\t\treturn constructor === this.$constructor;\n\t}\n}","import { Schema } from './schema';\nimport { Type\t\t} from './type';\n\n\n/**\n * Model Key class\n */\nexport class Key {\n\n\t/**\n\t * Type\n\t */\n\tpublic static Type: any = Type;\n\n\t/**\n\t * Default value\n\t */\n\tpublic default: any = null;\n\n\t/**\n\t * Key name\n\t */\n\tpublic name: string = null;\n\n\t/**\n\t * The schema\n\t */\n\tpublic schema: Schema = null;\n\n\t/**\n\t * The type\n\t */\n\tpublic type: Type = null;\n\n\t/**\n\t * Booted\n\t */\n\tprivate booted: boolean = false;\n\n\t/**\n\t * Key constructor\n\t */\n\tconstructor(schema: Schema, name: string, key: any) {\n\t\tthis.schema = schema;\n\t\tthis.name = name;\n\t\tthis.default = key.default || null;\n\t\tthis.type = key.type || key;\n\t}\n\n\t/**\n\t * Boot key\n\t */\n\tpublic boot() {\n\t\tif (this.booted) {\n\t\t\treturn this;\n\t\t}\n\t\tlet key = this,\n\t\t\t\tname = this.name,\n\t\t\t\tutils = this.schema.utils;\n\t\t// Fix type\n\t\tif (!(this.type instanceof Type)) {\n\t\t\tthis.type = this.schema.model.type(this.type);\n\t\t}\n\t\t// Define attribute\n\t\tObject.defineProperty(this.schema.$constructor.prototype, name, {\n\t\t\tget: function() {\n\t\t\t\tlet value = this.$attributes[name],\n\t\t\t\t\t\tmutator = this.constructor.$cache.mutators.get[name];\n\t\t\t\tif (utils.isUndefined(mutator)) {\n\t\t\t\t\tlet fn = utils.camelCase(['get', name, 'attribute'].join(' '));\n\t\t\t\t\tmutator = \n\t\t\t\t\t\tthis.constructor.$cache.mutators.get[name] =\n\t\t\t\t\t\tutils.isFunction(this[fn]) ? fn : null;\n\t\t\t\t}\n\t\t\t\tif (mutator !== null) {\n\t\t\t\t\tvalue = this[mutator].apply(this, [value]);\n\t\t\t\t}\n\t\t\t\treturn value;\n\t\t\t},\n\t\t\tset: function(value) {\n\t\t\t\tvar prev = this.$attributes[name];\n\t\t\t\t// Evaluate\n\t\t\t\t// !! Use mutator here\n\t\t\t\tvalue = key.evaluate(value, this);\n\t\t\t\tthis.$attributes[name] = value;\n\t\t\t\treturn this;\n\t\t\t}\n\t\t});\n\t\tthis.booted = true;\n\t\treturn this;\n\t}\n\n\t/**\n\t * Evaluate \n\t */\n\tpublic evaluate(value: any, model: any) {\n\t\tvalue = this.type.convert(value);\n\t\treturn value;\n\t}\n}","import { Key } from './key';\n\n/**\n * The Model Schema class\n */\nexport class Schema {\n\n\t/**\n\t * The Key\n\t */\n\tpublic static Key: any = Key;\n\n\t/**\n\t * The keys\n\t */\n\tpublic keys: Array<Key> = [];\n\n\t/**\n\t * Methods\n\t */\n\tpublic methods: object = {};\n\n\t/**\n\t * Statics\n\t */\n\tpublic statics: object = {};\n\n\t/**\n\t * Virtuals\n\t */\n\tpublic virtuals: object = {};\n\n\t/**\n\t * The constructor\n\t */\n\tprivate $constructor: any;\n\n\t/**\n\t * Booted up\n\t */\n\tprivate booted: boolean = false;\n\n\t/**\n\t * Schema constructor\n\t */\n\tconstructor(keys: object) {\n\t\tlet index = 0;\n\t\tthis.keys.$index = {};\n\t\tthis.utils.forEach(keys, (key, name) => {\n\t\t\tvar key_instance = new Key(this, name, key);\n\t\t\tthis.keys.$index[key_instance.name] = index++;\n\t\t\tthis.keys.push(key_instance);\n\t\t});\n\t}\n\n\t/** \n\t * Get ModelJS instance\n\t */\n\tpublic get model() {\n\t\treturn this.constructor.model;\n\t}\n\n\t/**\n\t * Get utils\n\t */\n\tpublic get utils() {\n\t\treturn this.model.utils;\n\t}\n\n\t/**\n\t * Boot schema\n\t */\n\tpublic boot() {\n\t\tif (this.booted) {\n\t\t\treturn this;\n\t\t}\n\t\tlet utils = this.utils;\n\t\tif (this.$constructor.inherits) {\n\t\t\tlet inherits = this.$constructor.inherits;\n\t\t\t// Boot dependency if not yet booted\n\t\t\tif (!utils.isUndefined(inherits) && !utils.isFunction(inherits)) {\n\t\t\t\tthis.$constructor.inherits = this.model.schemas[inherits].boot().$constructor;\n\t\t\t}\n\t\t\tutils.inherit(this.$constructor.inherits, this.$constructor);\n\t\t}\n\t\t// Extend constructor\n\t\tthis.extend(this, function(constructor: any) {\n\t\t\tthis.boot = boot;\n\t\t\tthis.load = load;\n\n\t\t\t////////\n\n\t\t\t/**\n\t\t\t * Boot model\n\t\t\t */\n\t\t\tfunction boot() {\n\t\t\t\tthis.constructor.$cache = {\n\t\t\t\t\tmutators: {\n\t\t\t\t\t\tget: {},\n\t\t\t\t\t\tset: {}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tthis.$attributes = {};\n\t\t\t\tthis.$listeners = {};\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Load attributes\n\t\t\t */\n\t\t\tfunction load(data) {\n\t\t\t\tutils.forEach(data || {}, (value, key) => {\n\t\t\t\t\tthis[key] = value;\n\t\t\t\t});\n\t\t\t\treturn this;\n\t\t\t}\n\t\t});\n\t\tthis.booted = true;\n\t\treturn this;\n\t}\n\n\t/**\n\t * Define a model\n\t */\n\tpublic define(constructor: any) {\n\t\tconstructor.isModel = true;\n\t\tthis.$constructor = constructor;\n\t\treturn constructor.schema = this;\n\t}\n\n\t/**\n\t * Extend a constructor\n\t */\n\tpublic extend(schema: any, define?: any) {\n\t\t// Extend constructor prototype\n\t\tthis.utils.forEach(schema.methods, (value, key, object) => {\n\t\t\tschema.$constructor.prototype[key] = value;\n\t\t});\n\t\tthis.utils.forEach(schema.statics, (value, key, object) => {\n\t\t\tschema.$constructor[key] = value;\n\t\t});\n\t\tthis.utils.forEach(schema.virtuals, (virtual, key) => {\n\t\t\tlet definition: any = {};\n\t\t\tif (this.utils.isFunction(virtual)) {\n\t\t\t\tdefinition.get = virtual;\n\t\t\t} else {\n\t\t\t\tif (!virtual) {\n\t\t\t\t\tvirtual = {};\n\t\t\t\t}\n\t\t\t\tif (this.utils.isFunction(virtual.get)) {\n\t\t\t\t\tdefinition.get = virtual.get;\n\t\t\t\t}\n\t\t\t\tif (this.utils.isFunction(virtual.set)) {\n\t\t\t\t\tdefinition.set = virtual.set;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this.utils.isFunction(definition.get) || this.utils.isFunction(definition.set)) {\n\t\t\t\tObject.defineProperty(schema.$constructor.prototype, key, definition);\n\t\t\t}\n\t\t});\n\t\tif (!this.utils.isUndefined(define)) {\n\t\t\tdefine.apply(schema.$constructor.prototype, [schema.$constructor]);\n\t\t}\n\t\treturn this;\n\t}\n\n\t/**\n\t * Inherit a model\n\t */\n\tpublic inherit(model: any) {\n\t\tthis.$constructor.inherits = model;\n\t\treturn this;\n\t}\n\n\t/**\n\t * Get key\n\t */\n\tpublic getKey(name: string) {\n\t\treturn this.keys[this.keys.$index[name]];\n\t}\n\n\t/**\n\t * Setup a method\n\t */\n\tpublic method(name: string, callback: any) {\n\t\tthis.methods[name] = callback;\n\t\treturn this;\n\t}\n\n\t/**\n\t * Setup a static method\n\t */\n\tpublic static(name: string, callback: any) {\n\t\tthis.statics[name] = callback;\n\t\treturn this;\n\t}\n\n\t/**\n\t * Call super method\n\t */\n\tpublic super(model: any, name: string, args?: any) {\n\t\tif (name === 'constructor') {\n\t\t\treturn this.$constructor.inherits.apply(model, args || []);\n\t\t} else {\n\t\t\treturn this.$constructor.inherits.prototype[name].apply(model, args || []);\n\t\t}\n\t}\n\n\t/**\n\t * Setup a virtual method\n\t */\n\tpublic virtual(method: string, name: string, callback: any) {\n\t\tif (this.utils.isUndefined(this.virtuals[name])) {\n\t\t\tthis.virtuals[name] = {};\n\t\t} else if (this.utils.isFunction(this.virtuals[name])) {\n\t\t\tthis.virtuals[name] = {\n\t\t\t\tget: this.virtuals[name]\n\t\t\t};\n\t\t}\n\t\tthis.virtuals[name][method] = callback;\n\t\treturn this;\n\t}\n}","/**\n * Model utilities\n */\nexport class Utils {\n\n\t/**\n\t * Undefined\n\t */\n\tpublic undefined: any;\n\n\t/**\n\t * The constructor\n\t */\n\tconstructor() {\n\t\tthis.undefined = (function(undefined) {\n\t\t\treturn undefined;\n\t\t})();\n\t}\n\n  /**\n   * To camel case\n   */\n  public camelCase(str) {\n    return str.replace(/[-_]+/g, ' ').replace(/(?:^\\w|[A-Z]|\\b\\w|[\\s-_]+)/g, function(match, index) {\n      if (+match === 0) {\n        return ''; // or if (/\\s+/.test(match)) for white spaces\n      }\n      return index === 0 ? match.toLowerCase() : match.toUpperCase();\n    });\n  }\n\n\t/**\n\t * Extend\n\t */\n\tpublic extend(left, right) {\n    this.forEach(right, function(value, name) {\n      left[name] = value;\n    });\n    return left;\n\t}\n\n\t/**\n\t * Foreach\n\t */\n\tpublic forEach(object: object, callback: any) {\n    for (let o in object) {\n      if (object.hasOwnProperty(o)) {\n        if (callback.apply(object, [object[o], o, object]) === false) {\n          return false;\n        }\n      }\n    }\n    return true;\n\t}\n\n\t/**\n\t * Inherit a protoype\n\t */\n\tpublic inherit(parent: any, child: any) {\n    child.prototype = Object.create(parent.prototype);\n    child.prototype.constructor = child;\n    this.extend(child, parent);\n    return child;\n\t}\n\n\t/**\n\t * Is function\n\t */\n\tpublic isFunction(variable: any) {\n    return !!(variable && variable.constructor && variable.call && variable.apply);\n\t}\n\n\t/**\n\t * Is undefined\n\t */\n\tpublic isUndefined(variable: any) {\n\t\treturn variable === this.undefined;\n\t}\n}","import { Collection } from './collection';\nimport { Schema \t\t} from './schema';\nimport { Type \t\t\t} from './type';\nimport { Utils  \t\t} from './utils';\n\n/**\n * The ModelJS class\n */\nexport class Model {\n\n\t/**\n\t * The Collection\n\t */\n\tpublic Collection: any = Collection;\n\n\t/**\n\t * The Model\n\t */\n\tpublic Model: any = Model;\n\n\t/**\n\t * Set Schema so that it can be accessible by modeljs.Schema\n\t */\n\tpublic Schema: any = Schema;\n\n\t/**\n\t * Types\n\t */\n\tpublic Types: object = {};\n\n\t/**\n\t * The utilities\n\t */\n\tpublic utils: Utils = new Utils();\n\n\t/**\n\t * Booted\n\t */\n\tprivate booted: boolean = false;\n\n\t/**\n\t * Models\n\t */\n\tprivate models: object = {};\n\n\t/**\n\t * Schemas\n\t */\n\tprivate schemas: object = {};\n\n\t/**\n\t * Model constructor\n\t */\n\tconstructor() {\n\t\tthis.Collection.model \n\t\t\t= this.Schema.model \n\t\t\t= this.utils.model \n\t\t\t= this;\n\t\tthis.Types.$keys = [];\n\t\tthis.Types.$length = 0;\n\t\t// Set keys\n\t\tthis.schemas.$keys = [];\n\t\t// Initial types are Javasript Native types\n    ['Array', 'Boolean', 'Date', 'Number', 'Object', 'String'].forEach((type) => {\n    \tthis.type(type, window[type]);\n    });\n\t}\n\n\t/** \n\t * Boot up\n\t * Models need to be booted up so that the dependencies within schemas can be properly handled\n\t */\n\tpublic boot() {\n\t\tif (this.booted) {\n\t\t\treturn this;\n\t\t}\n\t\t// Boot schemas\n\t\tthis.schemas.$keys.forEach((name) => {\n\t\t\tthis.models[name] = this.schemas[name].boot().$constructor;\n\t\t\tthis.type(name, this.models[name]);\n\t\t});\n\t\t// Boot keys\n\t\tthis.schemas.$keys.forEach((name) => {\n\t\t\tthis.schemas[name].keys.forEach((key) => {\n\t\t\t\tkey.boot();\n\t\t\t});\n\t\t});\n\t\tthis.booted = true;\n\t\treturn this;\n\t}\n\n\t/**\n\t * Register or retrieve a Model\n\t */\n\tpublic model(name: string, schema?: Schema, constructor?: any) {\n\t\tif (this.utils.isUndefined(schema)) {\n\t\t\tif (!this.booted) {\n\t\t\t\tthrow new Error('ModelJS must be booted first');\n\t\t\t}\n\t\t\treturn this.models[name];\n\t\t} else {\n\t\t\tconstructor.$name = name;\n\t\t\tthis.schemas[name] = schema.define(constructor);\n\t\t\tthis.schemas.$keys.push(name);\n\t\t\treturn this.schemas[name];\n\t\t}\n\t}\n\n\t/**\n\t * Register/retrieve type\n\t */\n\tpublic type(name: string, constructor?: any) {\n\t\tif (this.utils.isUndefined(constructor)) {\n\t\t\tif (this.utils.isFunction(name)) {\n\t\t\t\tfor (let i = 0; i < this.Types.$length; i++) {\n\t\t\t\t\tlet type = this.Types[this.Types.$keys[i]];\n\t\t\t\t\tif (type.match(name)) {\n\t\t\t\t\t\treturn type;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this.utils.isUndefined(this.Types[name])) {\n\t\t\t\tthrow new Error('Type `' + name + '` does not exist');\n\t\t\t}\n\t\t\treturn this.Types[name];\n\t\t} else {\n\t\t\tif (!this.utils.isUndefined(this.Types[name])) {\n\t\t\t\tthrow new Error('Type `' + name + '` already exists');\n\t\t\t}\n\t\t\tthis.Types[name] = new Type(name, constructor);\n\t\t\tthis.Types.$keys.push(name);\n\t\t\tthis.Types.$length++;\n\t\t\treturn this;\n\t\t}\n\t}\n}","import { Model } from './model/model';\n\nexport let ModelJS = new Model();"],"names":[],"mappings":"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"}